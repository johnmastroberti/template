cmake_minimum_required(VERSION 3.10)
project(test)
set(CMAKE_BUILD_TYPE Debug)

# Makefile target to remove files generated by cmake
add_custom_target("cleanall"
  "rm" "-rf" 
  "CMakeCache.txt" 
  "CMakeFiles"
  "Makefile" 
  "cmake_install.cmake"
  "compile_commands.json")

# 3rd party libraries
find_package(fmt REQUIRED)
find_package(spdlog REQUIRED)

# Source files
include_directories(${PROJECT_SOURCE_DIR}/include)
file(GLOB sources ${PROJECT_SOURCE_DIR}/src/*.cpp)
file(GLOB headers ${PROJECT_SOURCE_DIR}/include/*.hpp)

# Compiler settings
## Warnings
SET(WARNING_FLAGS 
  "-Wall \
  -Wextra \
  -Wpedantic \
  -Wshadow \
  -Wconversion \
  -Wredundant-decls \
  -Wcast-align \
  -Wmissing-include-dirs \
  -Wswitch-enum \
  -Wswitch-default \
  -Winvalid-pch \
  -Wredundant-decls \
  -Wformat=2 \
  -Wmissing-format-attribute \
  -Wformat-nonliteral \
  -Werror"
)
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${WARNING_FLAGS}")

# Enable Address Sanitizer and UB Sanitizer for debug builds
SET(ASAN_FLAGS "-fsanitize=address -fno-optimize-sibling-calls -fsanitize-address-use-after-scope -fno-omit-frame-pointer")
SET(UBSAN_FLAGS "-fsanitize=undefined")

SET(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} ${ASAN_FLAGS} ${UBSAN_FLAGS}")
SET(CMAKE_LINKER_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} ${ASAN_FLAGS} ${UBSAN_FLAGS}")

## Set C++ standard to C++20
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED True)

# Output compile commands for use with clangd lsp
SET(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# Define the executable and libraries to be linked
add_executable(test ${sources} ${headers})
target_link_libraries(test fmt::fmt spdlog::spdlog)
